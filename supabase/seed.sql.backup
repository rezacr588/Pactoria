-- Seed data for Pactoria Contract Management System
-- This file contains comprehensive test data for all MVP features

-- Clean existing test data (only in test environment)
DO $$
BEGIN
  -- Only run in test/development environments
  IF current_database() LIKE '%test%' OR current_database() LIKE '%dev%' THEN
    -- Clean in reverse order of dependencies
    DELETE FROM contract_snapshots WHERE created_by IN (SELECT id FROM auth.users WHERE email LIKE '%@example.com');
    DELETE FROM contract_approvals WHERE contract_id IN (SELECT id FROM contracts WHERE created_by IN (SELECT id FROM auth.users WHERE email LIKE '%@example.com'));
    DELETE FROM contract_comments WHERE contract_id IN (SELECT id FROM contracts WHERE created_by IN (SELECT id FROM auth.users WHERE email LIKE '%@example.com'));
    DELETE FROM contract_collaborators WHERE contract_id IN (SELECT id FROM contracts WHERE created_by IN (SELECT id FROM auth.users WHERE email LIKE '%@example.com'));
    DELETE FROM contract_versions WHERE contract_id IN (SELECT id FROM contracts WHERE created_by IN (SELECT id FROM auth.users WHERE email LIKE '%@example.com'));
    DELETE FROM contracts WHERE created_by IN (SELECT id FROM auth.users WHERE email LIKE '%@example.com');
    DELETE FROM team_members WHERE team_id IN (SELECT id FROM teams WHERE created_by IN (SELECT id FROM auth.users WHERE email LIKE '%@example.com'));
    DELETE FROM teams WHERE created_by IN (SELECT id FROM auth.users WHERE email LIKE '%@example.com');
    DELETE FROM user_profiles WHERE id IN (SELECT id FROM auth.users WHERE email LIKE '%@example.com');
    DELETE FROM auth.users WHERE email LIKE '%@example.com';
  END IF;
END $$;

-- Create test users with different roles
INSERT INTO auth.users (id, email, encrypted_password, email_confirmed_at, created_at, updated_at, raw_app_meta_data, raw_user_meta_data)
VALUES
  -- Admin users
  ('11111111-1111-1111-1111-111111111111', 'admin@example.com', crypt('AdminPass123!', gen_salt('bf')), NOW(), NOW(), NOW(), 
   '{"provider":"email","providers":["email"],"role":"admin"}', '{"full_name":"Admin User","avatar_url":"https://api.dicebear.com/7.x/avataaars/svg?seed=admin"}'),
  
  -- Regular users
  ('22222222-2222-2222-2222-222222222222', 'john.doe@example.com', crypt('UserPass123!', gen_salt('bf')), NOW(), NOW(), NOW(),
   '{"provider":"email","providers":["email"],"role":"user"}', '{"full_name":"John Doe","avatar_url":"https://api.dicebear.com/7.x/avataaars/svg?seed=john"}'),
  
  ('33333333-3333-3333-3333-333333333333', 'jane.smith@example.com', crypt('UserPass123!', gen_salt('bf')), NOW(), NOW(), NOW(),
   '{"provider":"email","providers":["email"],"role":"user"}', '{"full_name":"Jane Smith","avatar_url":"https://api.dicebear.com/7.x/avataaars/svg?seed=jane"}'),
  
  ('44444444-4444-4444-4444-444444444444', 'bob.wilson@example.com', crypt('UserPass123!', gen_salt('bf')), NOW(), NOW(), NOW(),
   '{"provider":"email","providers":["email"],"role":"user"}', '{"full_name":"Bob Wilson","avatar_url":"https://api.dicebear.com/7.x/avataaars/svg?seed=bob"}'),
  
  -- Manager users
  ('55555555-5555-5555-5555-555555555555', 'alice.manager@example.com', crypt('ManagerPass123!', gen_salt('bf')), NOW(), NOW(), NOW(),
   '{"provider":"email","providers":["email"],"role":"manager"}', '{"full_name":"Alice Manager","avatar_url":"https://api.dicebear.com/7.x/avataaars/svg?seed=alice"}'),
  
  ('66666666-6666-6666-6666-666666666666', 'charlie.lead@example.com', crypt('ManagerPass123!', gen_salt('bf')), NOW(), NOW(), NOW(),
   '{"provider":"email","providers":["email"],"role":"manager"}', '{"full_name":"Charlie Lead","avatar_url":"https://api.dicebear.com/7.x/avataaars/svg?seed=charlie"}'),
  
  -- Legal team users
  ('77777777-7777-7777-7777-777777777777', 'legal.advisor@example.com', crypt('LegalPass123!', gen_salt('bf')), NOW(), NOW(), NOW(),
   '{"provider":"email","providers":["email"],"role":"legal"}', '{"full_name":"Legal Advisor","avatar_url":"https://api.dicebear.com/7.x/avataaars/svg?seed=legal"}'),
  
  -- External collaborators
  ('88888888-8888-8888-8888-888888888888', 'external.partner@example.com', crypt('PartnerPass123!', gen_salt('bf')), NOW(), NOW(), NOW(),
   '{"provider":"email","providers":["email"],"role":"external"}', '{"full_name":"External Partner","avatar_url":"https://api.dicebear.com/7.x/avataaars/svg?seed=external"}'),
  
  -- Test user for automation
  ('99999999-9999-9999-9999-999999999999', 'test.user@example.com', crypt('TestPass123!', gen_salt('bf')), NOW(), NOW(), NOW(),
   '{"provider":"email","providers":["email"],"role":"user"}', '{"full_name":"Test User","avatar_url":"https://api.dicebear.com/7.x/avataaars/svg?seed=test"}'),
  
  -- Inactive user for testing
  ('aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa', 'inactive.user@example.com', crypt('InactivePass123!', gen_salt('bf')), NULL, NOW(), NOW(),
   '{"provider":"email","providers":["email"],"role":"user"}', '{"full_name":"Inactive User","avatar_url":"https://api.dicebear.com/7.x/avataaars/svg?seed=inactive"}');

-- Create user profiles
INSERT INTO user_profiles (id, full_name, avatar_url, role, department, phone, timezone, created_at, updated_at)
VALUES
  ('11111111-1111-1111-1111-111111111111', 'Admin User', 'https://api.dicebear.com/7.x/avataaars/svg?seed=admin', 'admin', 'Administration', '+44 20 1234 5678', 'Europe/London', NOW(), NOW()),
  ('22222222-2222-2222-2222-222222222222', 'John Doe', 'https://api.dicebear.com/7.x/avataaars/svg?seed=john', 'user', 'Sales', '+44 20 2345 6789', 'Europe/London', NOW(), NOW()),
  ('33333333-3333-3333-3333-333333333333', 'Jane Smith', 'https://api.dicebear.com/7.x/avataaars/svg?seed=jane', 'user', 'Marketing', '+44 20 3456 7890', 'Europe/London', NOW(), NOW()),
  ('44444444-4444-4444-4444-444444444444', 'Bob Wilson', 'https://api.dicebear.com/7.x/avataaars/svg?seed=bob', 'user', 'Engineering', '+44 20 4567 8901', 'Europe/London', NOW(), NOW()),
  ('55555555-5555-5555-5555-555555555555', 'Alice Manager', 'https://api.dicebear.com/7.x/avataaars/svg?seed=alice', 'manager', 'Operations', '+44 20 5678 9012', 'Europe/London', NOW(), NOW()),
  ('66666666-6666-6666-6666-666666666666', 'Charlie Lead', 'https://api.dicebear.com/7.x/avataaars/svg?seed=charlie', 'manager', 'Product', '+44 20 6789 0123', 'Europe/London', NOW(), NOW()),
  ('77777777-7777-7777-7777-777777777777', 'Legal Advisor', 'https://api.dicebear.com/7.x/avataaars/svg?seed=legal', 'legal', 'Legal', '+44 20 7890 1234', 'Europe/London', NOW(), NOW()),
  ('88888888-8888-8888-8888-888888888888', 'External Partner', 'https://api.dicebear.com/7.x/avataaars/svg?seed=external', 'external', 'Partner', '+44 20 8901 2345', 'Europe/London', NOW(), NOW()),
  ('99999999-9999-9999-9999-999999999999', 'Test User', 'https://api.dicebear.com/7.x/avataaars/svg?seed=test', 'user', 'QA', '+44 20 9012 3456', 'Europe/London', NOW(), NOW()),
  ('aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa', 'Inactive User', 'https://api.dicebear.com/7.x/avataaars/svg?seed=inactive', 'user', 'Unknown', NULL, 'Europe/London', NOW(), NOW());

-- Create teams
INSERT INTO teams (id, name, description, created_by, created_at, updated_at)
VALUES
  ('team-001', 'Sales Team', 'Handles all sales contracts and agreements', '55555555-5555-5555-5555-555555555555', NOW(), NOW()),
  ('team-002', 'Legal Team', 'Reviews and approves all legal documents', '77777777-7777-7777-7777-777777777777', NOW(), NOW()),
  ('team-003', 'Engineering Team', 'Technical contracts and SLAs', '66666666-6666-6666-6666-666666666666', NOW(), NOW()),
  ('team-004', 'Executive Team', 'High-value contract approvals', '11111111-1111-1111-1111-111111111111', NOW(), NOW());

-- Add team members
INSERT INTO team_members (id, team_id, user_id, role, joined_at)
VALUES
  ('tm-001', 'team-001', '22222222-2222-2222-2222-222222222222', 'member', NOW()),
  ('tm-002', 'team-001', '33333333-3333-3333-3333-333333333333', 'member', NOW()),
  ('tm-003', 'team-001', '55555555-5555-5555-5555-555555555555', 'owner', NOW()),
  ('tm-004', 'team-002', '77777777-7777-7777-7777-777777777777', 'owner', NOW()),
  ('tm-005', 'team-002', '11111111-1111-1111-1111-111111111111', 'admin', NOW()),
  ('tm-006', 'team-003', '44444444-4444-4444-4444-444444444444', 'member', NOW()),
  ('tm-007', 'team-003', '66666666-6666-6666-6666-666666666666', 'owner', NOW()),
  ('tm-008', 'team-004', '11111111-1111-1111-1111-111111111111', 'owner', NOW()),
  ('tm-009', 'team-004', '55555555-5555-5555-5555-555555555555', 'member', NOW()),
  ('tm-010', 'team-004', '66666666-6666-6666-6666-666666666666', 'member', NOW());

-- Create contracts with various statuses and types
INSERT INTO contracts (id, title, content, status, type, value, currency, start_date, end_date, created_by, team_id, metadata, created_at, updated_at)
VALUES
  -- Active contracts
  ('contract-001', 'Software License Agreement', '{"type":"doc","content":[{"type":"heading","attrs":{"level":1},"content":[{"type":"text","text":"Software License Agreement"}]},{"type":"paragraph","content":[{"type":"text","text":"This agreement is between Company A and Company B for software licensing."}]}]}', 
   'active', 'license', 50000.00, 'GBP', '2024-01-01', '2024-12-31', '22222222-2222-2222-2222-222222222222', 'team-001', 
   '{"client":"Company B","category":"software","risk_level":"low"}', NOW() - INTERVAL '30 days', NOW()),
  
  ('contract-002', 'Non-Disclosure Agreement', '{"type":"doc","content":[{"type":"heading","attrs":{"level":1},"content":[{"type":"text","text":"Mutual Non-Disclosure Agreement"}]},{"type":"paragraph","content":[{"type":"text","text":"Confidentiality agreement between parties."}]}]}',
   'active', 'nda', 0, 'GBP', '2024-01-15', '2025-01-15', '33333333-3333-3333-3333-333333333333', 'team-002',
   '{"client":"Partner Corp","category":"legal","risk_level":"low"}', NOW() - INTERVAL '20 days', NOW()),
  
  -- Draft contracts
  ('contract-003', 'Service Level Agreement', '{"type":"doc","content":[{"type":"heading","attrs":{"level":1},"content":[{"type":"text","text":"Service Level Agreement"}]},{"type":"paragraph","content":[{"type":"text","text":"Draft SLA for cloud services."}]}]}',
   'draft', 'sla', 120000.00, 'GBP', '2024-02-01', '2025-01-31', '44444444-4444-4444-4444-444444444444', 'team-003',
   '{"client":"Tech Solutions Ltd","category":"services","risk_level":"medium"}', NOW() - INTERVAL '10 days', NOW()),
  
  ('contract-004', 'Employment Contract', '{"type":"doc","content":[{"type":"heading","attrs":{"level":1},"content":[{"type":"text","text":"Employment Contract"}]},{"type":"paragraph","content":[{"type":"text","text":"Standard employment terms and conditions."}]}]}',
   'draft', 'employment', 65000.00, 'GBP', '2024-03-01', NULL, '55555555-5555-5555-5555-555555555555', 'team-001',
   '{"employee":"New Hire","category":"hr","risk_level":"low"}', NOW() - INTERVAL '5 days', NOW()),
  
  -- Pending approval contracts
  ('contract-005', 'Supplier Agreement', '{"type":"doc","content":[{"type":"heading","attrs":{"level":1},"content":[{"type":"text","text":"Supplier Agreement"}]},{"type":"paragraph","content":[{"type":"text","text":"Terms for supply of materials."}]}]}',
   'pending_approval', 'supplier', 250000.00, 'GBP', '2024-02-15', '2025-02-14', '22222222-2222-2222-2222-222222222222', 'team-001',
   '{"supplier":"Materials Co","category":"procurement","risk_level":"high","requires_legal_review":true}', NOW() - INTERVAL '3 days', NOW()),
  
  ('contract-006', 'Partnership Agreement', '{"type":"doc","content":[{"type":"heading","attrs":{"level":1},"content":[{"type":"text","text":"Strategic Partnership Agreement"}]},{"type":"paragraph","content":[{"type":"text","text":"Partnership terms between companies."}]}]}',
   'pending_approval', 'partnership', 500000.00, 'GBP', '2024-04-01', '2026-03-31', '66666666-6666-6666-6666-666666666666', 'team-004',
   '{"partner":"Global Partners Inc","category":"strategic","risk_level":"high","board_approval_required":true}', NOW() - INTERVAL '2 days', NOW()),
  
  -- Approved contracts
  ('contract-007', 'Consultancy Agreement', '{"type":"doc","content":[{"type":"heading","attrs":{"level":1},"content":[{"type":"text","text":"Consultancy Agreement"}]},{"type":"paragraph","content":[{"type":"text","text":"Consulting services agreement."}]}]}',
   'approved', 'consultancy', 35000.00, 'GBP', '2024-01-01', '2024-06-30', '33333333-3333-3333-3333-333333333333', 'team-001',
   '{"consultant":"Expert Consulting","category":"services","risk_level":"low"}', NOW() - INTERVAL '25 days', NOW()),
  
  -- Expired contracts
  ('contract-008', 'Old Service Contract', '{"type":"doc","content":[{"type":"heading","attrs":{"level":1},"content":[{"type":"text","text":"Service Contract"}]},{"type":"paragraph","content":[{"type":"text","text":"Expired service agreement."}]}]}',
   'expired', 'service', 80000.00, 'GBP', '2023-01-01', '2023-12-31', '22222222-2222-2222-2222-222222222222', 'team-001',
   '{"client":"Old Client Corp","category":"services","risk_level":"low"}', NOW() - INTERVAL '400 days', NOW() - INTERVAL '30 days'),
  
  -- Terminated contracts
  ('contract-009', 'Cancelled Project Agreement', '{"type":"doc","content":[{"type":"heading","attrs":{"level":1},"content":[{"type":"text","text":"Project Agreement"}]},{"type":"paragraph","content":[{"type":"text","text":"Terminated project contract."}]}]}',
   'terminated', 'project', 150000.00, 'GBP', '2023-06-01', '2024-05-31', '44444444-4444-4444-4444-444444444444', 'team-003',
   '{"client":"Failed Project Inc","category":"project","risk_level":"high","termination_reason":"mutual_agreement"}', NOW() - INTERVAL '200 days', NOW() - INTERVAL '60 days'),
  
  -- Large contract for stress testing
  ('contract-010', 'Enterprise Agreement', '{"type":"doc","content":[{"type":"heading","attrs":{"level":1},"content":[{"type":"text","text":"Enterprise Agreement"}]},{"type":"paragraph","content":[{"type":"text","text":"' || repeat('Large contract content for testing. ', 1000) || '"}]}]}',
   'active', 'enterprise', 5000000.00, 'GBP', '2024-01-01', '2029-12-31', '11111111-1111-1111-1111-111111111111', 'team-004',
   '{"client":"Mega Corp","category":"enterprise","risk_level":"high","compliance_required":true}', NOW() - INTERVAL '60 days', NOW()),
  
  -- Test contracts for specific scenarios
  ('test-contract-123', 'Test Contract for E2E', '{"type":"doc","content":[{"type":"paragraph","content":[{"type":"text","text":"Test contract content"}]}]}',
   'draft', 'test', 1000.00, 'GBP', '2024-01-01', '2024-12-31', '99999999-9999-9999-9999-999999999999', 'team-001',
   '{"test":true}', NOW(), NOW()),
  
  ('readonly-contract-123', 'Read-Only Test Contract', '{"type":"doc","content":[{"type":"paragraph","content":[{"type":"text","text":"This is a read-only contract"}]}]}',
   'active', 'test', 1000.00, 'GBP', '2024-01-01', '2024-12-31', '11111111-1111-1111-1111-111111111111', 'team-002',
   '{"test":true,"readonly":true}', NOW(), NOW()),
  
  ('stress-test-contract', 'Stress Test Contract', '{"type":"doc","content":[{"type":"paragraph","content":[{"type":"text","text":"Contract for stress testing"}]}]}',
   'draft', 'test', 1000.00, 'GBP', '2024-01-01', '2024-12-31', '99999999-9999-9999-9999-999999999999', 'team-003',
   '{"test":true,"stress_test":true}', NOW(), NOW()),
  
  ('performance-test-contract', 'Performance Test Contract', '{"type":"doc","content":[{"type":"paragraph","content":[{"type":"text","text":"Contract for performance testing"}]}]}',
   'draft', 'test', 1000.00, 'GBP', '2024-01-01', '2024-12-31', '99999999-9999-9999-9999-999999999999', 'team-003',
   '{"test":true,"performance_test":true}', NOW(), NOW());

-- Create contract versions
INSERT INTO contract_versions (id, contract_id, version_number, content, changes, created_by, created_at)
VALUES
  ('version-001', 'contract-001', 1, '{"type":"doc","content":[{"type":"paragraph","content":[{"type":"text","text":"Initial version"}]}]}', 
   '{"changes":["Initial creation"]}', '22222222-2222-2222-2222-222222222222', NOW() - INTERVAL '30 days'),
  ('version-002', 'contract-001', 2, '{"type":"doc","content":[{"type":"paragraph","content":[{"type":"text","text":"Updated terms"}]}]}',
   '{"changes":["Updated payment terms","Added termination clause"]}', '22222222-2222-2222-2222-222222222222', NOW() - INTERVAL '20 days'),
  ('version-003', 'contract-001', 3, '{"type":"doc","content":[{"type":"heading","attrs":{"level":1},"content":[{"type":"text","text":"Software License Agreement"}]},{"type":"paragraph","content":[{"type":"text","text":"This agreement is between Company A and Company B for software licensing."}]}]}',
   '{"changes":["Added header","Formatted document"]}', '33333333-3333-3333-3333-333333333333', NOW() - INTERVAL '10 days'),
  
  ('version-004', 'contract-005', 1, '{"type":"doc","content":[{"type":"paragraph","content":[{"type":"text","text":"Initial supplier agreement"}]}]}',
   '{"changes":["Initial draft"]}', '22222222-2222-2222-2222-222222222222', NOW() - INTERVAL '3 days'),
  ('version-005', 'contract-005', 2, '{"type":"doc","content":[{"type":"heading","attrs":{"level":1},"content":[{"type":"text","text":"Supplier Agreement"}]},{"type":"paragraph","content":[{"type":"text","text":"Terms for supply of materials."}]}]}',
   '{"changes":["Added delivery terms","Updated pricing"]}', '55555555-5555-5555-5555-555555555555', NOW() - INTERVAL '1 day');

-- Create contract collaborators
INSERT INTO contract_collaborators (id, contract_id, user_id, permission, added_by, added_at)
VALUES
  ('collab-001', 'contract-001', '33333333-3333-3333-3333-333333333333', 'edit', '22222222-2222-2222-2222-222222222222', NOW() - INTERVAL '25 days'),
  ('collab-002', 'contract-001', '55555555-5555-5555-5555-555555555555', 'view', '22222222-2222-2222-2222-222222222222', NOW() - INTERVAL '25 days'),
  ('collab-003', 'contract-002', '77777777-7777-7777-7777-777777777777', 'edit', '33333333-3333-3333-3333-333333333333', NOW() - INTERVAL '20 days'),
  ('collab-004', 'contract-003', '66666666-6666-6666-6666-666666666666', 'edit', '44444444-4444-4444-4444-444444444444', NOW() - INTERVAL '10 days'),
  ('collab-005', 'contract-005', '55555555-5555-5555-5555-555555555555', 'approve', '22222222-2222-2222-2222-222222222222', NOW() - INTERVAL '3 days'),
  ('collab-006', 'contract-005', '77777777-7777-7777-7777-777777777777', 'approve', '22222222-2222-2222-2222-222222222222', NOW() - INTERVAL '3 days'),
  ('collab-007', 'contract-006', '11111111-1111-1111-1111-111111111111', 'approve', '66666666-6666-6666-6666-666666666666', NOW() - INTERVAL '2 days'),
  ('collab-008', 'test-contract-123', '22222222-2222-2222-2222-222222222222', 'edit', '99999999-9999-9999-9999-999999999999', NOW()),
  ('collab-009', 'test-contract-123', '33333333-3333-3333-3333-333333333333', 'edit', '99999999-9999-9999-9999-999999999999', NOW()),
  ('collab-010', 'readonly-contract-123', '99999999-9999-9999-9999-999999999999', 'view', '11111111-1111-1111-1111-111111111111', NOW());

-- Create contract approvals
INSERT INTO contract_approvals (id, contract_id, approver_id, status, comments, approved_at, created_at, updated_at)
VALUES
  ('approval-001', 'contract-005', '55555555-5555-5555-5555-555555555555', 'pending', NULL, NULL, NOW() - INTERVAL '3 days', NOW()),
  ('approval-002', 'contract-005', '77777777-7777-7777-7777-777777777777', 'pending', NULL, NULL, NOW() - INTERVAL '3 days', NOW()),
  ('approval-003', 'contract-006', '11111111-1111-1111-1111-111111111111', 'pending', 'Needs board review', NULL, NOW() - INTERVAL '2 days', NOW()),
  ('approval-004', 'contract-007', '55555555-5555-5555-5555-555555555555', 'approved', 'Looks good', NOW() - INTERVAL '20 days', NOW() - INTERVAL '25 days', NOW() - INTERVAL '20 days'),
  ('approval-005', 'contract-007', '77777777-7777-7777-7777-777777777777', 'approved', 'Legal review complete', NOW() - INTERVAL '21 days', NOW() - INTERVAL '25 days', NOW() - INTERVAL '21 days');

-- Create contract comments
INSERT INTO contract_comments (id, contract_id, user_id, content, parent_id, resolved, created_at, updated_at)
VALUES
  ('comment-001', 'contract-001', '33333333-3333-3333-3333-333333333333', 'Please review the payment terms in section 3', NULL, false, NOW() - INTERVAL '15 days', NOW() - INTERVAL '15 days'),
  ('comment-002', 'contract-001', '22222222-2222-2222-2222-222222222222', 'I''ve updated the payment terms as discussed', 'comment-001', false, NOW() - INTERVAL '14 days', NOW() - INTERVAL '14 days'),
  ('comment-003', 'contract-001', '55555555-5555-5555-5555-555555555555', 'Looks good now, thanks!', 'comment-001', true, NOW() - INTERVAL '13 days', NOW() - INTERVAL '13 days'),
  
  ('comment-004', 'contract-005', '77777777-7777-7777-7777-777777777777', 'Legal review required for liability clauses', NULL, false, NOW() - INTERVAL '2 days', NOW() - INTERVAL '2 days'),
  ('comment-005', 'contract-005', '55555555-5555-5555-5555-555555555555', '@legal.advisor please review ASAP', 'comment-004', false, NOW() - INTERVAL '1 day', NOW() - INTERVAL '1 day'),
  
  ('comment-006', 'contract-006', '11111111-1111-1111-1111-111111111111', 'This requires board approval due to contract value', NULL, false, NOW() - INTERVAL '1 day', NOW() - INTERVAL '1 day'),
  
  ('comment-007', 'test-contract-123', '99999999-9999-9999-9999-999999999999', 'Test comment for E2E testing', NULL, false, NOW(), NOW()),
  ('comment-008', 'test-contract-123', '22222222-2222-2222-2222-222222222222', 'Reply to test comment', 'comment-007', false, NOW(), NOW());

-- Create contract snapshots
INSERT INTO contract_snapshots (id, contract_id, content, version_number, created_by, created_at)
VALUES
  ('snapshot-001', 'contract-001', '{"type":"doc","content":[{"type":"paragraph","content":[{"type":"text","text":"Snapshot at approval"}]}]}', 3, '55555555-5555-5555-5555-555555555555', NOW() - INTERVAL '10 days'),
  ('snapshot-002', 'contract-005', '{"type":"doc","content":[{"type":"paragraph","content":[{"type":"text","text":"Snapshot before legal review"}]}]}', 2, '77777777-7777-7777-7777-777777777777', NOW() - INTERVAL '2 days'),
  ('snapshot-003', 'contract-007', '{"type":"doc","content":[{"type":"paragraph","content":[{"type":"text","text":"Final approved version"}]}]}', 1, '55555555-5555-5555-5555-555555555555', NOW() - INTERVAL '20 days');

-- Create audit logs
INSERT INTO audit_logs (id, user_id, action, entity_type, entity_id, changes, ip_address, user_agent, created_at)
VALUES
  ('audit-001', '22222222-2222-2222-2222-222222222222', 'create', 'contract', 'contract-001', '{"title":"Software License Agreement"}', '192.168.1.1', 'Mozilla/5.0', NOW() - INTERVAL '30 days'),
  ('audit-002', '33333333-3333-3333-3333-333333333333', 'update', 'contract', 'contract-001', '{"status":"active"}', '192.168.1.2', 'Mozilla/5.0', NOW() - INTERVAL '25 days'),
  ('audit-003', '55555555-5555-5555-5555-555555555555', 'approve', 'contract', 'contract-007', '{"approved":true}', '192.168.1.3', 'Mozilla/5.0', NOW() - INTERVAL '20 days'),
  ('audit-004', '77777777-7777-7777-7777-777777777777', 'comment', 'contract', 'contract-005', '{"comment":"Legal review required"}', '192.168.1.4', 'Mozilla/5.0', NOW() - INTERVAL '2 days'),
  ('audit-005', '11111111-1111-1111-1111-111111111111', 'view', 'contract', 'contract-006', '{}', '192.168.1.5', 'Mozilla/5.0', NOW() - INTERVAL '1 day'),
  ('audit-006', '99999999-9999-9999-9999-999999999999', 'create', 'contract', 'test-contract-123', '{"title":"Test Contract for E2E"}', '192.168.1.100', 'Playwright/1.0', NOW());

-- Create notifications
INSERT INTO notifications (id, user_id, type, title, message, data, read, created_at)
VALUES
  ('notif-001', '55555555-5555-5555-5555-555555555555', 'approval_request', 'Contract Approval Required', 'You have a new contract to approve', '{"contract_id":"contract-005"}', false, NOW() - INTERVAL '3 days'),
  ('notif-002', '77777777-7777-7777-7777-777777777777', 'mention', 'You were mentioned', 'You were mentioned in a comment', '{"contract_id":"contract-005","comment_id":"comment-005"}', false, NOW() - INTERVAL '1 day'),
  ('notif-003', '22222222-2222-2222-2222-222222222222', 'contract_shared', 'Contract Shared', 'A contract was shared with you', '{"contract_id":"test-contract-123"}', true, NOW() - INTERVAL '1 hour'),
  ('notif-004', '11111111-1111-1111-1111-111111111111', 'approval_request', 'Board Approval Required', 'High-value contract needs approval', '{"contract_id":"contract-006"}', false, NOW() - INTERVAL '2 days'),
  ('notif-005', '33333333-3333-3333-3333-333333333333', 'comment_reply', 'Comment Reply', 'Someone replied to your comment', '{"contract_id":"contract-001","comment_id":"comment-002"}', true, NOW() - INTERVAL '14 days');

-- Create templates
INSERT INTO contract_templates (id, name, description, content, category, is_public, created_by, metadata, created_at, updated_at)
VALUES
  ('template-001', 'Standard NDA', 'Basic non-disclosure agreement template', '{"type":"doc","content":[{"type":"heading","attrs":{"level":1},"content":[{"type":"text","text":"Non-Disclosure Agreement"}]},{"type":"paragraph","content":[{"type":"text","text":"This Non-Disclosure Agreement..."}]}]}', 'legal', true, '77777777-7777-7777-7777-777777777777', '{"industry":"general","jurisdiction":"UK"}', NOW() - INTERVAL '90 days', NOW()),
  ('template-002', 'Service Agreement', 'Standard service agreement template', '{"type":"doc","content":[{"type":"heading","attrs":{"level":1},"content":[{"type":"text","text":"Service Agreement"}]},{"type":"paragraph","content":[{"type":"text","text":"This Service Agreement..."}]}]}', 'service', true, '55555555-5555-5555-5555-555555555555', '{"industry":"technology","jurisdiction":"UK"}', NOW() - INTERVAL '60 days', NOW()),
  ('template-003', 'Employment Contract', 'UK employment contract template', '{"type":"doc","content":[{"type":"heading","attrs":{"level":1},"content":[{"type":"text","text":"Employment Contract"}]},{"type":"paragraph","content":[{"type":"text","text":"This Employment Contract..."}]}]}', 'hr', true, '77777777-7777-7777-7777-777777777777', '{"industry":"general","jurisdiction":"UK","gdpr_compliant":true}', NOW() - INTERVAL '45 days', NOW()),
  ('template-004', 'GDPR Data Processing Agreement', 'GDPR-compliant DPA template', '{"type":"doc","content":[{"type":"heading","attrs":{"level":1},"content":[{"type":"text","text":"Data Processing Agreement"}]},{"type":"paragraph","content":[{"type":"text","text":"This Data Processing Agreement..."}]}]}', 'compliance', true, '77777777-7777-7777-7777-777777777777', '{"industry":"general","jurisdiction":"EU","gdpr_compliant":true}', NOW() - INTERVAL '30 days', NOW()),
  ('template-005', 'Supplier Agreement', 'Standard supplier agreement', '{"type":"doc","content":[{"type":"heading","attrs":{"level":1},"content":[{"type":"text","text":"Supplier Agreement"}]},{"type":"paragraph","content":[{"type":"text","text":"This Supplier Agreement..."}]}]}', 'procurement', false, '66666666-6666-6666-6666-666666666666', '{"industry":"manufacturing","jurisdiction":"UK"}', NOW() - INTERVAL '20 days', NOW());

-- Create user preferences
INSERT INTO user_preferences (id, user_id, theme, email_notifications, push_notifications, language, timezone, created_at, updated_at)
VALUES
  ('pref-001', '22222222-2222-2222-2222-222222222222', 'light', true, true, 'en', 'Europe/London', NOW(), NOW()),
  ('pref-002', '33333333-3333-3333-3333-333333333333', 'dark', true, false, 'en', 'Europe/London', NOW(), NOW()),
  ('pref-003', '44444444-4444-4444-4444-444444444444', 'auto', false, false, 'en', 'Europe/London', NOW(), NOW()),
  ('pref-004', '55555555-5555-5555-5555-555555555555', 'light', true, true, 'en', 'Europe/London', NOW(), NOW()),
  ('pref-005', '99999999-9999-9999-9999-999999999999', 'light', false, false, 'en', 'Europe/London', NOW(), NOW());

-- Add some performance testing data (optional - can be commented out for lighter seeds)
-- Generate 100 additional contracts for performance testing
INSERT INTO contracts (id, title, content, status, type, value, currency, start_date, end_date, created_by, team_id, metadata, created_at, updated_at)
SELECT 
  'perf-contract-' || generate_series,
  'Performance Test Contract ' || generate_series,
  '{"type":"doc","content":[{"type":"paragraph","content":[{"type":"text","text":"Performance test contract ' || generate_series || '"}]}]}',
  CASE 
    WHEN generate_series % 4 = 0 THEN 'draft'
    WHEN generate_series % 4 = 1 THEN 'active'
    WHEN generate_series % 4 = 2 THEN 'pending_approval'
    ELSE 'approved'
  END,
  'test',
  (random() * 100000)::numeric(10,2),
  'GBP',
  CURRENT_DATE - INTERVAL '1 year' * random(),
  CURRENT_DATE + INTERVAL '1 year' * random(),
  CASE 
    WHEN generate_series % 3 = 0 THEN '22222222-2222-2222-2222-222222222222'
    WHEN generate_series % 3 = 1 THEN '33333333-3333-3333-3333-333333333333'
    ELSE '44444444-4444-4444-4444-444444444444'
  END,
  CASE 
    WHEN generate_series % 4 = 0 THEN 'team-001'
    WHEN generate_series % 4 = 1 THEN 'team-002'
    WHEN generate_series % 4 = 2 THEN 'team-003'
    ELSE 'team-004'
  END,
  '{"performance_test":true,"batch":' || (generate_series / 10)::int || '}',
  NOW() - INTERVAL '1 day' * (random() * 365)::int,
  NOW() - INTERVAL '1 hour' * (random() * 24)::int
FROM generate_series(1, 100);

-- Create indexes for better query performance (if not already created)
CREATE INDEX IF NOT EXISTS idx_contracts_status ON contracts(status);
CREATE INDEX IF NOT EXISTS idx_contracts_created_by ON contracts(created_by);
CREATE INDEX IF NOT EXISTS idx_contracts_team_id ON contracts(team_id);
CREATE INDEX IF NOT EXISTS idx_contracts_created_at ON contracts(created_at DESC);
CREATE INDEX IF NOT EXISTS idx_contract_approvals_contract_id ON contract_approvals(contract_id);
CREATE INDEX IF NOT EXISTS idx_contract_approvals_approver_id ON contract_approvals(approver_id);
CREATE INDEX IF NOT EXISTS idx_contract_approvals_status ON contract_approvals(status);
CREATE INDEX IF NOT EXISTS idx_contract_comments_contract_id ON contract_comments(contract_id);
CREATE INDEX IF NOT EXISTS idx_contract_collaborators_contract_id ON contract_collaborators(contract_id);
CREATE INDEX IF NOT EXISTS idx_contract_collaborators_user_id ON contract_collaborators(user_id);
CREATE INDEX IF NOT EXISTS idx_notifications_user_id ON notifications(user_id);
CREATE INDEX IF NOT EXISTS idx_notifications_read ON notifications(read);
CREATE INDEX IF NOT EXISTS idx_audit_logs_user_id ON audit_logs(user_id);
CREATE INDEX IF NOT EXISTS idx_audit_logs_entity ON audit_logs(entity_type, entity_id);

-- Grant necessary permissions
GRANT ALL ON ALL TABLES IN SCHEMA public TO authenticated;
GRANT ALL ON ALL SEQUENCES IN SCHEMA public TO authenticated;
GRANT ALL ON ALL FUNCTIONS IN SCHEMA public TO authenticated;
